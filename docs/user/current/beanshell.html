<html>
<head><title>Scripting components in BeanShell</title></head>
<body>
<h1>Scripting components in BeanShell</h1>

Created by Stefan Rennick Egglestone 2006-07-07<BR>
Last update by Stefan Rennick Egglestone 2006-07-07<BR><BR>

<a href="#introduction">Introduction</a><br>
<a href="#basic">Starting to use the DynamicBeanShell component</a><BR>
<a href="#types">Datatypes of properties when using DynamicBeanShell</a><BR>
<a href="#errors">Syntax and runtime errors</a>

<H3><a name="introduction">Introduction</h3>

<P>
<a href="http://www.beanshell.org" target="_blank">BeanShell</a>
is a java-based scripting language and IDE that has been 
designed for easy integration into other applications. BeanShell
has been integrated into ECT through the addition of the
DynamicBeanShell component, which is capable of interpretting
a BeanShell script. This tutorial briefly describes
how to use this component, but for details of how to program
in BeanShell, you should read the documentation on their 
<a href="http://www.beanshell.org" target="_blank">project
web-site</a>.
</p>

<h3><a name="basic">Starting to use the DynamicBeanShell
component</h3>

<P>
For every script you want to integrate into an ECT
installation, you need to create one instance of the 
DynamicBeanShell component to interpret
this script. This can be located
in the "behaviour/scripting" category in the 
CapabilityBrowser. Figure 1 below shows an example
of DynamicBeanShell immediately after instantiation.
</P>
<img src="images/beanshell/preconfig.PNG"><BR>
<B>Figure 1 - Pre-configured instance of DynamicBeanShell</B>

<P>
The first task when configuring this instance
is to define the properties that will be manipulated 
by the script you want to use. For example, if you 
wanted to use a simple script that concatenated
two input strings to produce an output string, you 
might want to define three properties - called
<i>inputOne</i>, <i>inputTwo</i> and <i>output</i>.
To add a new set of input properties, enter 
the following text into property 
<I>inputNamesString</i>: <BR><BR>

<TT>inputOne inputTwo</tt><BR><BR>

(ie a list of property names, each of which
is seperated by a space). Similarly, enter the 
following text into property <i>outputNamesString</i>: <BR><BR>

<tt>output</tt>

</p>
<P>
After entering these details, three new properties
should be added to the component instance, as shown 
in figure 2 below:
</p>
<img src="images/beanshell/properties_added.PNG"><BR>
<B>Figure 2 - instance with properties added</b>

<P>
Once these properties have been added, then they can
be manipulated by a script. For the simple concatentation
example described above, such a script might look like this:
</P>

<TT>output = inputOne + inputTwo</tt>

<P>
To configure your DynamicBeanShell instance with this
script, simply paste it into its <i>script</i> property.
This script is then executed every time either
<I>inputOne</i> or <i>inputTwo</i> are modified.
Figure 3 below shows an example of this instance in use.
</P>
<img src="images/beanshell/use.PNG"><BR>
<B>Figure 3 - instance in use</b>
<P>
</p>

<h3><a name="types">Datetypes of properties manipulated by scripts</h3>

<P>
One tricky issue when using BeanShell scripts in ECT 
is working out the datatypes of any values 
provided through input properties of a 
DynamicBeanShell instance. This is because
the datatypes of such values
will depend upon the source that has been used to create them. 
For example, a value entered directly into a DynamicBeanShell
input property through 
the graph editor interface will always appear
to the script as an 
instance of <tt>java.lang.String</tt>, 
even if the original value entered by the user
was a number - 
so such a script might have to convert this value 
back to a number if this was the case. The datatypes of values 
generated by other components depend upon how the components
have been written - so, for example, if you connect the <i>connected</i>
property of an instance of <i>PhidgetInterfaceKit</i> to 
an input property of a 
DynamicBeanShell instance, then any value provided
on this input property would be typed as an instance
of <tt>java.lang.Boolean</tt>. There are many other
examples of datatypes used by components in ECT -
which might include <tt>java.lang.Integer</tt>, 
<tt>java.lang.Double</tt> etc. See the
<a href="../../developer/current/ECT_Component_Guidelines.html#properties">
Component development reference</a> for a list of available
datatypes that might appear in BeanShell scripts.
</P>
<P>
These issues are important, because the operation of a particular
script can be affected by the datatypes of values with which
it is supplied. For example, in the simple concatentation 
example given above,
this script will only work as expected if 
values typed as java.lang.String have been 
supplied through properties 
<I>inputOne</i> and <i>inputTwo</i>. 
If values with any other types are supplied, then results may not 
be as expected. So how can you tell what types of values
have been supplied to a particular input property? 
</p>

<P>
One possibility is to add an extra output property
to your DynamicBeanShell instance, called <I>type</i>,
and to add a line to your script that looks 
something like this:<BR><BR>

<tt>type = &lt;input_name&gt;.getClass().getName()</tt><BR><BR>

When this script is run, then the <i>type</i> property of 
your DynamicBeanShell instance would be set to the name 
of the class of the value on your chosen input property.
For example, it might be set to <tt>java.lang.String</tt>
if this value was a string. This addition to the script
can then be removed - as assuming that no changes are
made to your installation, any other values supplied
by the same mechanism will have the same datatypes as
the one you have just discovered
</p>

<P>
Additionally, once the class of a particular value is known, then your
script can be modified to perform any data conversion
operations if necessary. So, if you find that in a particular
installation involving a DynamicBeanShell instance that strings
are always provided to a particular beanshell property, and
that your script needs to work with integers, you can convert
the string to an integer using<BR><BR>

<TT>intValue = Integer.parseInt(stringValue)</tt><BR><BR>

</P>

<h3><a name="errors">Syntax and runtime errors</h3>

Unfortunately, if you introduce a syntax error when writing 
a script, or if your script generates a runtime error during
execution, these will not be reported directly to you
throught the DynamicBeanShell property interface - 
so your script might just appear not to work. This situation
will be resolved in the very near future.

</body>
</html>